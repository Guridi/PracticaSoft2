<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cliente</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Panel de Cliente</h1>
            <div class="user-info">
                <span>Bienvenido, {{ userName }}</span>
                <button @click="logout" class="btn btn-secondary">Cerrar Sesión</button>
            </div>
        </header>

        <main>
            <section class="form-section">
                <h2>Crear Nueva Orden</h2>
                <form @submit.prevent="createOrder">
                    <div class="form-group">
                        <label>Cliente:</label>
                        <input type="text" :value="userName" readonly class="readonly-input">
                    </div>

                    <div class="form-group">
                        <label>Producto:</label>
                        <select v-model="newOrder.producto_id" required>
                            <option value="">Seleccione un producto</option>
                            <option v-for="producto in productos" :key="producto.id" :value="producto.id">
                                {{ producto.nombre }} - {{ producto.tipo }}
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Almacén:</label>
                        <select v-model="newOrder.almacen_id" required>
                            <option value="">Seleccione un almacén</option>
                            <option v-for="almacen in almacenes" :key="almacen.id" :value="almacen.id">
                                {{ almacen.nombre }} - Capacidad disponible: {{ almacen.capacidad_disponible }}
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Chofer:</label>
                        <select v-model="newOrder.chofer_id" required>
                            <option value="">Seleccione un chofer</option>
                            <option v-for="delivery in deliveries" :key="delivery.id" :value="delivery.id">
                                {{ delivery.nombre }} - {{ delivery.vehiculo }}
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Volumen Solicitado:</label>
                        <input type="number" v-model.number="newOrder.volumen_solicitado" 
                               min="0" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label>Ubicación de Entrega:</label>
                        <input type="text" v-model="newOrder.ubicacion_entrega" required>
                    </div>

                    <div class="form-group">
                        <label>Precio Unitario (opcional):</label>
                        <input type="number" v-model.number="newOrder.precio_unitario" 
                               min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label>Notas (opcional):</label>
                        <textarea v-model="newOrder.notas" rows="3"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Crear Orden</button>
                </form>
            </section>

            <section class="orders-section">
                <h2>Mis Órdenes</h2>
                <div v-if="orders.length === 0" class="empty-message">
                    No tienes órdenes registradas.
                </div>
                <table v-else>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Producto</th>
                            <th>Almacén</th>
                            <th>Chofer</th>
                            <th>Volumen</th>
                            <th>Ubicación</th>
                            <th>Precio Unit.</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Fecha</th>
                            <th>Notas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="order in orders" :key="order.id">
                            <td>{{ order.id }}</td>
                            <td>{{ getProductoNombre(order.producto_id) }}</td>
                            <td>{{ getAlmacenNombre(order.almacen_id) }}</td>
                            <td>{{ getChoferNombre(order.chofer_id) }}</td>
                            <td>{{ order.volumen_solicitado }}</td>
                            <td>{{ order.ubicacion_entrega }}</td>
                            <td>{{ order.precio_unitario || '-' }}</td>
                            <td>{{ order.precio_total || '-' }}</td>
                            <td><span :class="'status-' + order.estado">{{ order.estado }}</span></td>
                            <td>{{ formatDate(order.fecha_orden) }}</td>
                            <td>{{ order.notas || '-' }}</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <script src="app-cliente.js"></script>
</body>
</html>
